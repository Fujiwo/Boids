<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,minimum-scale=1, maximum-scale=1, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="Author" content="Fujiwo">
    <meta name="Classification" content="Boids (an artificial life program) &mdash;shoal simulator written in TypeScript&mdash;">
    <meta name="Description" content="Boids (an artificial life program) &mdash;shoal simulator written in TypeScript&mdash;">
    <meta name="keywords" content="Boids,artificial life,TypeScript,JavaScript">
    <title>Boids (an artificial life program) &mdash;shoal simulator written in TypeScript&mdash; | Sho's Software</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <style>
        body {
            font-size: x-small;
        }
        /* h1 {
            font-size: x-small;
            padding: 0.3em 0.4em;
            color:black;
            background:whitesmoke;
            border-left: solid 4px gray;
            border-bottom: solid 2px darkgray;
        } */
        canvas {
            background:snow;
            border: solid 1px lightgray;
            margin: 0.3em;
            padding: 0.1em;
        }
    </style>
</head>
<body>
    <div id="header">
        <nav>
            <p class="navigator">
                &lt;<a href="../index2.html">HOME</a>&gt; &mdash; &lt;<a href="./document.html">Documents</a>&gt; &mdash; &lt;Boids (an artificial life program) &mdash;shoal simulator written in TypeScript&mdash;&gt;
            </p>
        </nav>
        <p class="small">
            <script type="text/javascript">
                document.write("Last updated on " + document.lastModified + ".")
            </script>
        </p>
        <div>
        <h2 id="titleBar"><a href="https://en.wikipedia.org/wiki/Boids">Boids</a> (an artificial life program) &mdash;shoal simulator written in TypeScript&mdash; | Sho's Software</h2>
            <div>
                <p>Source code: <a href="https://github.com/Fujiwo/Shos.Boids">Shos.Boids | GitHub</a></p>
                <a href="./boids3d.html">3D Version</a>
                <a href="./boids3ds.html">3D (Cross-eyed/Parallel Free-viewing Stereoscopy) Version</a>
            </div>
            <div>
                <p>Boids is an artificial life simulation originally developed by <a href="http://www.red3d.com/cwr/">Craig Reynolds</a>.
                Boids simulates the three behaviors of each individual animal in a group:</p>
                <ul>
                    <li>Separation: steer to avoid crowding</li>
                    <li>Alignment: steer towards the average heading of the group</li>
                    <li>Cohesion: steer to move toward the average position of the group</li>
                </ul>
            </div>
            <div>
                <form name="settingForm">
                    <label>boid size(*):</label> <input type="number" name="boidSizeTextBox">
                    <label>initial boid Count(*):</label> <input type="number" name="initialBoidCountTextBox">
                    <label>maximum speed:</label> <input type="number" name="maximumSpeedTextBox">
                    <label>cohesion parameter:</label> <input type="number" name="cohesionParameterTextBox">
                    <label>separation parameter:</label> <input type="number" name="separationParameterTextBox">
                    <label>alignment parameter:</label> <input type="number" name="alignmentParameterTextBox">
                    <label>random parameter:</label> <input type="number" name="randomParameterTextBox">
                    <input id="submitButton" type="button" value="submit">
                    <input id="reloadButton" type="button" value="reload">
                    <input id="resetButton" type="button" value="reset">
                    <span>(*) require reload</span>
                </form>
            </div>
        </div>
    </div>
    <div>
        <canvas id="canvas"></canvas>
    </div>
    <div id="footer">
        <nav>
            <p class="navigator">
                See also:
                <ul>
                    <li><a href="http://www.red3d.com/cwr/boids/">Boids (Flocks, Herds, and Schools: a Distributed Behavioral Model)</a></li>
                    <li><a href="https://en.wikipedia.org/wiki/Boids">Boids - Wikipedia</a></li>
                </ul>
            </p>
        </nav>
        <div><p class="copyright">Copyright &copy; 2019 Sho's Software</p></div>
    </div>
    <!-- <script src="boids.js"></script> -->
    <!-- <script src="boids.min.js"></script> -->
    <script>"use strict";var Shos;!function(Shos){var Boids;!function(Boids){var Core2D;!function(Core2D){var Helper;!function(Helper){var Vector2D=function(){function Vector2D(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.x=x,this.y=y}return Object.defineProperty(Vector2D.prototype,"absoluteValue",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),Vector2D.prototype.clone=function(){return new Vector2D(this.x,this.y)},Vector2D.prototype.plus=function(another){return new Vector2D(this.x+another.x,this.y+another.y)},Vector2D.prototype.plusEqual=function(another){this.x+=another.x,this.y+=another.y},Vector2D.prototype.minus=function(another){return new Vector2D(this.x-another.x,this.y-another.y)},Vector2D.prototype.minusEqual=function(another){this.x-=another.x,this.y-=another.y},Vector2D.prototype.multiply=function(value){return new Vector2D(this.x*value,this.y*value)},Vector2D.prototype.innerProduct=function(another){return new Vector2D(this.x*another.x,this.y*another.y)},Vector2D.prototype.divideBy=function(value){return new Vector2D(this.x/value,this.y/value)},Vector2D.prototype.divideByEqual=function(value){this.x/=value,this.y/=value},Vector2D.prototype.getDistance=function(another){return this.minus(another).absoluteValue},Vector2D}();Helper.Vector2D=Vector2D}(Helper=Core2D.Helper||(Core2D.Helper={}))}(Core2D=Boids.Core2D||(Boids.Core2D={}))}(Boids=Shos.Boids||(Shos.Boids={}))}(Shos||(Shos={})),function(Shos){var Boids,Boids_1,Core2D;Boids_1=Boids=Shos.Boids||(Shos.Boids={}),function(Core2D){var Vector2D=Shos.Boids.Core2D.Helper.Vector2D,Boid=function(){function Boid(position,velocity,color){void 0===position&&(position=new Vector2D),void 0===velocity&&(velocity=new Vector2D),void 0===color&&(color="black"),this.position=position,this.velocity=velocity,this.color=color}return Object.defineProperty(Boid.prototype,"speed",{get:function(){return this.velocity.absoluteValue},enumerable:!0,configurable:!0}),Boid.prototype.draw=function(context){this.drawShape(context,this.position,Boid.size,this.color)},Boid.prototype.move=function(){this.velocity.plusEqual(Boid.getRandomVector()),this.position.plusEqual(this.velocity)},Boid.prototype.getDistance=function(another){return this.position.getDistance(another.position)},Boid.prototype.drawShape=function(context,center,size,color){var halfVelocity=this.velocity.multiply(size/2),point1=this.position.plus(halfVelocity),middlePoint=this.position.minus(halfVelocity),velocityAbsoluteValue=this.velocity.absoluteValue,unitVelocity=this.velocity.multiply(size/(velocityAbsoluteValue*velocityAbsoluteValue)),point2=middlePoint.plus(new Vector2D(unitVelocity.y,-unitVelocity.x)),point3=middlePoint.plus(new Vector2D(-unitVelocity.y,unitVelocity.x));Boid.drawPolygon(context,[point1,point2,point3],color)},Boid.drawPolygon=function(context,polygon,color){var polygonLength=polygon.length;if(!(polygonLength<2)){context.fillStyle=color,context.beginPath(),context.moveTo(polygon[0].x,polygon[0].y);for(var index=1;index<polygonLength;index++)context.lineTo(polygon[index].x,polygon[index].y);context.fill()}},Boid.getRandomVector=function(){return new Vector2D(Boid.getRandomDistance(),Boid.getRandomDistance())},Boid.getRandomDistance=function(){return Boid.maximumRandomDistance*(Math.random()+Math.random())-Boid.maximumRandomDistance},Boid.defaultSize=4,Boid.defaultMaximumRandomDistance=2,Boid.size=Boid.defaultSize,Boid.maximumRandomDistance=Boid.defaultMaximumRandomDistance,Boid}();Core2D.Boid=Boid;var Boids=function(){function Boids(){this.boids=[]}return Boids.prototype.append=function(boid){this.boids.push(boid)},Boids.prototype.move=function(size){for(var sum=this.getSum(),boidCount=this.boids.length,index=0;index<boidCount;index++){var boid=this.boids[index],speed=boid.speed;this.cohesion(sum.position,boid),this.separation(index),this.alignment(sum.velocity,boid),speed>=Boids.maximumSpeed&&(boid.velocity=boid.velocity.multiply(Boids.maximumSpeed/speed)),(boid.position.x<0&&boid.velocity.x<0||boid.position.x>size.x&&boid.velocity.x>0)&&(boid.velocity.x*=-1),(boid.position.y<0&&boid.velocity.y<0||boid.position.y>size.y&&boid.velocity.y>0)&&(boid.velocity.y*=-1),boid.move()}},Boids.prototype.getSum=function(){for(var sum=new Boid,boidCount=this.boids.length,index=0;index<boidCount;index++)sum.position.plusEqual(this.boids[index].position),sum.velocity.plusEqual(this.boids[index].velocity);return sum},Boids.prototype.cohesion=function(sum,boid){var center=sum.clone();center.minusEqual(boid.position),center.divideByEqual(this.boids.length-1),boid.velocity.plusEqual(center.minus(boid.position).divideBy(Boids.cohesionParameter))},Boids.prototype.separation=function(index){for(var i=0,length_1=this.boids.length;i<length_1;i++)i!==index&&this.boids[i].getDistance(this.boids[index])<Boids.separationParameter&&this.boids[index].velocity.minusEqual(this.boids[i].position.minus(this.boids[index].position))},Boids.prototype.alignment=function(sum,boid){var average=sum.clone();average.minusEqual(boid.velocity),average.divideByEqual(this.boids.length-1),boid.velocity.plusEqual(average.minus(boid.velocity).divideBy(Boids.alignmentParameter))},Boids.defaultInitialBoidCount=250,Boids.defaultMaximumSpeed=8,Boids.defaultCohesionParameter=100,Boids.defaultSeparationParameter=10,Boids.defaultAlignmentParameter=7,Boids.initialBoidCount=Boids.defaultInitialBoidCount,Boids.maximumSpeed=Boids.defaultMaximumSpeed,Boids.cohesionParameter=Boids.defaultCohesionParameter,Boids.separationParameter=Boids.defaultSeparationParameter,Boids.alignmentParameter=Boids.defaultAlignmentParameter,Boids}();Core2D.Boids=Boids}(Core2D=Boids_1.Core2D||(Boids_1.Core2D={}))}(Shos||(Shos={})),function(Shos){var Boids,Boids_2,Application2D;Boids_2=Boids=Shos.Boids||(Shos.Boids={}),function(Application2D){var Vector2D=Shos.Boids.Core2D.Helper.Vector2D,Boids=Shos.Boids.Core2D.Boids,Boid=Shos.Boids.Core2D.Boid,View=function(){function View(){this.onMouseDown=function(clickedPosition){},this.onMouseUp=function(){},this.size=new Vector2D,this.canvas=document.querySelector("#canvas"),this.context=this.canvas.getContext("2d"),this.bindEvents()}return View.prototype.update=function(){this.size.x=this.canvas.width=Math.round(window.innerWidth*View.sizeRate);var screenHeight=View.getScreenHeight();this.size.y=this.canvas.height=Math.round(Math.max(this.size.x*View.heightRate,screenHeight*View.sizeRate)),this.size.y>screenHeight&&window.resizeBy(0,this.size.y-screenHeight)},View.prototype.drawBoids=function(boids){this.drawAllBoid(boids.boids)},View.prototype.bindEvents=function(){var _this=this;this.canvas.addEventListener("mousedown",(function(e){return _this.onMouseDown(View.getMousePosition(_this.canvas,e))})),this.canvas.addEventListener("touchstart",(function(e){return _this.onMouseDown(View.getTouchPosition(_this.canvas,e))})),this.canvas.addEventListener("mouseup",(function(){return _this.onMouseUp()})),this.canvas.addEventListener("touchend",(function(){return _this.onMouseUp()}))},View.getScreenHeight=function(){var header=document.getElementById("header"),footer=document.getElementById("footer");return window.innerHeight-(null==header?0:header.clientHeight)-(null==footer?0:footer.clientHeight)},View.getMousePosition=function(element,e){var rect=element.getBoundingClientRect();return new Vector2D(e.clientX-rect.left,e.clientY-rect.top)},View.getTouchPosition=function(element,e){var rect=element.getBoundingClientRect(),touch=e.changedTouches[0];return new Vector2D(touch.clientX-rect.left,touch.clientY-rect.top)},View.prototype.drawAllBoid=function(boids){this.context.clearRect(0,0,this.size.x,this.size.y);for(var index=0,length_2=boids.length;index<length_2;index++)boids[index].draw(this.context);this.drawCount(boids.length)},View.prototype.drawCount=function(count){this.context.fillStyle="gray",this.context.font="14px",this.context.fillText("Boids: "+String(count),20,20)},View.sizeRate=.95,View.heightRate=.6180339887498948,View}(),Settings=function(){function Settings(){}return Settings.get=function(){return{boidSize:Boid.size,randomParameter:Boid.maximumRandomDistance,initialBoidCount:Boids.initialBoidCount,maximumSpeed:Boids.maximumSpeed,cohesionParameter:Boids.cohesionParameter,separationParameter:Boids.separationParameter,alignmentParameter:Boids.alignmentParameter}},Settings.set=function(boidSize,randomParameter,initialBoidCount,maximumSpeed,cohesionParameter,separationParameter,alignmentParameter){Boid.size=boidSize,Boid.maximumRandomDistance=randomParameter,Boids.initialBoidCount=initialBoidCount,Boids.maximumSpeed=maximumSpeed,Boids.cohesionParameter=cohesionParameter,Boids.separationParameter=separationParameter,Boids.alignmentParameter=alignmentParameter},Settings.reset=function(){Boid.size=Boid.defaultSize,Boid.maximumRandomDistance=Boid.defaultMaximumRandomDistance,Boids.initialBoidCount=Boids.defaultInitialBoidCount,Boids.maximumSpeed=Boids.defaultMaximumSpeed,Boids.cohesionParameter=Boids.defaultCohesionParameter,Boids.separationParameter=Boids.defaultSeparationParameter,Boids.alignmentParameter=Boids.defaultAlignmentParameter},Settings.save=function(){return!!window.localStorage&&(window.localStorage.setItem(Settings.key,JSON.stringify(Settings.get())),!0)},Settings.load=function(){if(!window.localStorage)return!1;var jsonText=window.localStorage.getItem(Settings.key);if(null==jsonText)return!1;var data=JSON.parse(jsonText);return null!=data&&(Settings.set(data.boidSize,data.randomParameter,data.initialBoidCount,data.maximumSpeed,data.cohesionParameter,data.separationParameter,data.alignmentParameter),!0)},Settings.key="ShoBoids",Settings}(),SettingsPanel=function(){function SettingsPanel(){}return SettingsPanel.initialize=function(){SettingsPanel.initializeHandlers(),SettingsPanel.initializeForm()},SettingsPanel.initializeHandlers=function(){document.getElementById("submitButton").onclick=SettingsPanel.onFormSubmit,document.getElementById("reloadButton").onclick=SettingsPanel.onReload,document.getElementById("resetButton").onclick=SettingsPanel.onReset,SettingsPanel.enableEnterKey("boidSizeTextBox"),SettingsPanel.enableEnterKey("randomParameterTextBox"),SettingsPanel.enableEnterKey("initialBoidCountTextBox"),SettingsPanel.enableEnterKey("maximumSpeedTextBox"),SettingsPanel.enableEnterKey("cohesionParameterTextBox"),SettingsPanel.enableEnterKey("separationParameterTextBox"),SettingsPanel.enableEnterKey("alignmentParameterTextBox")},SettingsPanel.onFormSubmit=function(){SettingsPanel.setSettingsFromForm(),SettingsPanel.initializeForm()},SettingsPanel.onReload=function(){SettingsPanel.setSettingsFromForm(),window.location.reload(!1)},SettingsPanel.setSettingsFromForm=function(){var settingForm=document.settingForm;Settings.set(Number(settingForm.boidSizeTextBox.value),Number(settingForm.randomParameterTextBox.value),Number(settingForm.initialBoidCountTextBox.value),Number(settingForm.maximumSpeedTextBox.value),Number(settingForm.cohesionParameterTextBox.value),Number(settingForm.separationParameterTextBox.value),Number(settingForm.alignmentParameterTextBox.value)),Settings.save()},SettingsPanel.onReset=function(){Settings.reset(),Settings.save(),SettingsPanel.initializeForm()},SettingsPanel.initializeForm=function(){var settings=Settings.get();SettingsPanel.setToInput("boidSizeTextBox",settings.boidSize),SettingsPanel.setToInput("randomParameterTextBox",settings.randomParameter),SettingsPanel.setToInput("initialBoidCountTextBox",settings.initialBoidCount),SettingsPanel.setToInput("maximumSpeedTextBox",settings.maximumSpeed),SettingsPanel.setToInput("cohesionParameterTextBox",settings.cohesionParameter),SettingsPanel.setToInput("separationParameterTextBox",settings.separationParameter),SettingsPanel.setToInput("alignmentParameterTextBox",settings.alignmentParameter)},SettingsPanel.setToInput=function(inputName,value){var elements=document.getElementsByName(inputName);elements.length>0&&(elements[0].value=String(value))},SettingsPanel.enableEnterKey=function(inputName){var elements=document.getElementsByName(inputName);elements.length>0&&elements[0].addEventListener("keypress",SettingsPanel.onKeyPress)},SettingsPanel.onKeyPress=function(){null!=window.event&&13==window.event.keyCode&&SettingsPanel.onFormSubmit()},SettingsPanel}(),Program=function(){function Program(){var _this=this;this.appendTimer=0,Settings.load(),this.boids=new Boids,this.view=new View,setTimeout((function(){return _this.initialize()}),Program.startTime)}return Program.prototype.initialize=function(){var _this=this;this.bindEvents(),this.view.update(),this.appendBoids(Boids.initialBoidCount),setTimeout((function(){return _this.step()}),Program.startTime),SettingsPanel.initialize()},Program.prototype.bindEvents=function(){var _this=this;this.view.onMouseDown=function(position){return _this.appendBoids(1,position)},this.view.onMouseUp=function(){return clearInterval(_this.appendTimer)},window.addEventListener("resize",(function(){return _this.view.update()}))},Program.prototype.appendBoids=function(count,position){var _this=this,index=0;this.appendTimer=setInterval((function(){count>0&&index>=count?clearInterval(_this.appendTimer):(_this.boids.append(Program.createBoid(_this.view.size,position)),index++)}),Program.createTime)},Program.createBoid=function(areaSize,position){return new Boid(position||areaSize.innerProduct(new Vector2D(Math.random(),Math.random())),new Vector2D,this.getRandomColor())},Program.getRandomColor=function(){return"rgba("+String(Program.getRandomColorValue())+", "+String(Program.getRandomColorValue())+", "+String(Program.getRandomColorValue())+", "+String(Program.getOpactiy())+")"},Program.getRandomColorValue=function(){return Math.round(Math.random()*Program.colorValueBase)},Program.getOpactiy=function(){return Math.round(Math.random()*(Program.opacityBase2-Program.opacityBase1)+Program.opacityBase1)},Program.prototype.step=function(){var _this=this;this.view.drawBoids(this.boids),this.boids.move(this.view.size),requestAnimationFrame((function(){return _this.step()}))},Program.createTime=10,Program.startTime=100,Program.colorValueBase=160,Program.opacityBase1=.4,Program.opacityBase2=.6,Program}();onload=function(){return new Program}}(Application2D=Boids_2.Application2D||(Boids_2.Application2D={}))}(Shos||(Shos={}));</script>
</body>
</html>